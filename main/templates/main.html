{% extends 'base.html' %}

{% block meta %}
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LiteraSync (Portal Pencarian Buku Online)</title>
{% endblock meta %}

{% block content %}
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }

        table, th, td {
            border: 1px solid black;
        }

        th, td {
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }

        #suggestions {
            border: 1px solid #ccc;
            width: 200px;
            display: none;
            position: absolute;
        }

        #suggestions div {
            padding: 8px;
            cursor: pointer;
        }

        #suggestions div:hover {
            background-color: #f5f5f5;
        }
    </style>

    <h2>LiteraSync (Portal Pencarian Buku Online)</h2>
    <p>Anda memiliki total {{ items.count }} jenis item yang tersimpan pada library.</p>

    <!-- Kolom Pencarian -->
    <div>
        <label for="search">Cari Buku:</label>
        <input type="text" id="search" onkeyup="showSuggestions(this.value)">
        <div id="suggestions"></div>
    </div>

    <!-- Tabel Daftar Buku -->
    <table>
        <thead>
            <tr>
                <th>No</th>
                <th>Nama buku</th>
                <th>Jumlah</th>
                <th>Deskripsi</th>
            </tr>
        </thead>
        <tbody>
            {% for item in items %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>{{ item.name }}</td>
                    <td>{{ item.amount }}</td>
                    <td>{{ item.description }}</td>
                    <td>
                        <a href="{% url 'main:increment_item' item.id %}">+</a>
                        <a href="{% url 'main:decrement_item' item.id %}">-</a>
                        <a href="{% url 'main:delete_item' item.id %}">Delete</a>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <br />
    <a href="{% url 'main:create_item' %}">
        <button>
            Tambah Buku Baru
        </button>
    </a>

    <script>
        const books = [
            "Jujutsu Kaisen ep. 235 Leaks",
            "The Maze Runner: The Kill Order",
            "Automate the Boring Stuff with Python: Practical Programming for Total Beginners",
            "Thinking in Java by Brucke Eckel"
        ];

        function showSuggestions(str) {
            const suggestions = document.getElementById("suggestions");
            suggestions.innerHTML = "";
            if (str.length === 0) {
                suggestions.style.display = "none";
                return;
            }

            const filteredBooks = books.filter(book => book.toLowerCase().includes(str.toLowerCase()));
            for (const book of filteredBooks) {
                const div = document.createElement("div");
                div.innerHTML = book;
                div.onclick = function() {
                    document.getElementById("search").value = book;
                    suggestions.style.display = "none";
                };
                suggestions.appendChild(div);
            }

            if (filteredBooks.length > 0) {
                suggestions.style.display = "block";
            } else {
                suggestions.style.display = "none";
            }
        }
    </script>
<h5>Sesi terakhir login: {{ last_login }}</h5>    
<a href="{% url 'main:logout' %}">
    <button>
        Logout
    </button>
</a>
{% endblock content %}
